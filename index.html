<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒãƒ­ï¼ãƒãƒ¯ãƒ¦ - v1.2 (ì˜¤ë””ì˜¤ ì‹±í¬)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', 'Hiragino Kaku Gothic Pro', sans-serif;
            background: linear-gradient(135deg, #8B7AA8 0%, #A47CB9 100%);
            min-height: 100vh;
            padding: 20px;
            color: #2c3e50;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* ìŒì•… í”Œë ˆì´ì–´ ì˜ì—­ */
        .music-player {
            background: rgba(0, 0, 0, 0.9);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            margin-bottom: 30px;
            color: white;
        }

        .album-art {
            width: 200px;
            height: 200px;
            margin: 0 auto 20px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
        }

        .album-art img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .song-title {
            text-align: center;
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .song-artist {
            text-align: center;
            color: #bbb;
            margin-bottom: 20px;
        }

        .audio-controls {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-top: 20px;
        }

        .play-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #A47CB9;
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .play-btn:hover {
            background: #8B7AA8;
            transform: scale(1.1);
        }

        .progress-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #A47CB9, #FFE66D);
            width: 0%;
            transition: width 0.1s linear;
            border-radius: 3px;
        }

        .time-display {
            display: flex;
            justify-content: space-between;
            font-size: 0.85em;
            color: #bbb;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .volume-slider {
            width: 100px;
            height: 4px;
            -webkit-appearance: none;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            outline: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            background: #A47CB9;
            border-radius: 50%;
            cursor: pointer;
        }

        /* íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ */
        .file-upload-zone {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            border: 2px dashed #A47CB9;
        }

        .file-upload-zone.has-file {
            border-color: #5AA9E6;
            background: rgba(90, 169, 230, 0.1);
        }

        .upload-btn {
            padding: 12px 24px;
            background: #A47CB9;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .upload-btn:hover {
            background: #8B7AA8;
            transform: translateY(-2px);
        }

        header {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2em;
            color: #A47CB9;
            margin-bottom: 10px;
        }

        .song-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
        }

        .word-count {
            font-size: 1.5em;
            font-weight: bold;
            color: #5AA9E6;
        }

        .word-count span {
            font-size: 0.6em;
            color: #7f8c8d;
            display: block;
            margin-top: 5px;
        }

        .emotion-keywords {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .keyword-tag {
            padding: 6px 14px;
            background: linear-gradient(135deg, #A47CB9 0%, #8B7AA8 100%);
            color: white;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(164, 124, 185, 0.3);
        }

        .filter-controls {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .filter-toggle {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .filter-toggle label {
            font-weight: 600;
            color: #34495e;
            cursor: pointer;
            user-select: none;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: #ddd;
            border-radius: 15px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.active {
            background: #5AA9E6;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background: white;
            top: 2px;
            left: 2px;
            transition: left 0.3s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch.active::after {
            left: 32px;
        }

        .lyrics-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .lyric-line {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        /* ê°„ì£¼ëŠ” í´ë¦­ ë¶ˆê°€ëŠ¥ í‘œì‹œ */
        .lyric-line[data-id="4.5"],
        .lyric-line[data-id="43.5"] {
            cursor: default;
            opacity: 0.7;
        }

        .lyric-line:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        /* ê°„ì£¼ëŠ” hover íš¨ê³¼ ì—†ìŒ */
        .lyric-line[data-id="4.5"]:hover,
        .lyric-line[data-id="43.5"]:hover {
            transform: none;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .lyric-line.hidden {
            display: none;
        }

        .lyric-line.known {
            opacity: 0.4;
            filter: blur(1px);
        }

        .lyric-line.active {
            background: linear-gradient(135deg, #FFE66D 0%, #FFD93D 100%);
            transform: translateX(10px);
            box-shadow: 0 8px 25px rgba(255, 230, 109, 0.4);
            border-left: 5px solid #FFA500;
        }

        .lyric-line:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .lyric-line.bookmarked {
            border-left: 5px solid #FFE66D;
        }

        .action-buttons {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }

        .icon-btn {
            background: none;
            border: none;
            font-size: 1.3em;
            cursor: pointer;
            opacity: 0.3;
            transition: all 0.3s;
            padding: 5px;
        }

        .icon-btn:hover,
        .icon-btn.active {
            opacity: 1;
            transform: scale(1.1);
        }

        .jp-text {
            font-size: 1.4em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            line-height: 1.6;
        }

        /* ê°„ì£¼ í‘œì‹œ ìŠ¤íƒ€ì¼ */
        .lyric-line[data-id="4.5"] {
            background: linear-gradient(135deg, #A47CB9 0%, #8B7AA8 100%);
            text-align: center;
            opacity: 0.8;
        }

        .lyric-line[data-id="4.5"] .jp-text {
            color: white;
            font-size: 1.2em;
        }

        .lyric-line[data-id="4.5"] .reading-text,
        .lyric-line[data-id="4.5"] .romanized-text,
        .lyric-line[data-id="4.5"] .kr-text {
            color: rgba(255, 255, 255, 0.8);
        }

        .reading-text {
            font-size: 1em;
            color: #7f8c8d;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .romanized-text {
            font-size: 0.9em;
            color: #95a5a6;
            font-style: italic;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .kr-text {
            font-size: 1.1em;
            color: #34495e;
            font-weight: 500;
            line-height: 1.4;
        }

        .stats {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px 30px;
            border-radius: 15px;
            margin-top: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #A47CB9;
        }

        .stat-label {
            font-size: 0.85em;
            color: #7f8c8d;
            margin-top: 5px;
        }

        @media (max-width: 600px) {
            body {
                padding: 10px;
            }

            .album-art {
                width: 150px;
                height: 150px;
            }

            .song-title {
                font-size: 1.4em;
            }

            .audio-controls {
                flex-direction: column;
            }

            .volume-control {
                width: 100%;
                justify-content: center;
            }

            .filter-controls {
                flex-direction: column;
                gap: 15px;
            }

            .stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ìŒì•… í”Œë ˆì´ì–´ -->
        <div class="music-player">
            <div class="album-art" id="albumArt">
                ğŸµ
            </div>
            <div class="song-title">ãƒãƒ­ï¼ãƒãƒ¯ãƒ¦ (Hello/How are you)</div>
            <div class="song-artist">é¹¿ä¹ƒ (Kano)</div>

            <div class="audio-controls">
                <button class="play-btn" id="playBtn">â–¶ï¸</button>
                <div class="progress-container">
                    <div class="progress-bar" id="progressBar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="time-display">
                        <span id="currentTime">0:00</span>
                        <span id="duration">0:00</span>
                    </div>
                </div>
                <div class="volume-control">
                    <span>ğŸ”Š</span>
                    <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="70">
                </div>
            </div>

            <audio id="audioPlayer" preload="auto">
                <!-- ì˜¤ë””ì˜¤ íŒŒì¼ ê²½ë¡œë¥¼ ì—¬ê¸°ì— ì§€ì •í•˜ê±°ë‚˜ ì—…ë¡œë“œë¡œ ì²˜ë¦¬ -->
            </audio>
        </div>

        <!-- íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ -->
        <div class="file-upload-zone" id="uploadZone">
            <p style="margin-bottom: 15px; color: #7f8c8d;">
                ğŸ’¿ ì˜¤ë””ì˜¤ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë©´ ê°€ì‚¬ì™€ ìë™ìœ¼ë¡œ ì‹±í¬ë©ë‹ˆë‹¤
            </p>
            <input type="file" id="audioFile" accept="audio/*" style="display: none;">
            <button class="upload-btn" onclick="document.getElementById('audioFile').click()">
                ì˜¤ë””ì˜¤ íŒŒì¼ ì„ íƒ
            </button>
            <p id="fileName" style="margin-top: 10px; color: #5AA9E6; font-weight: 600;"></p>
        </div>

        <header>
            <h1>ãƒãƒ­ï¼ãƒãƒ¯ãƒ¦ (Hello/How are you)</h1>
            <p style="color: #7f8c8d; margin-top: 5px;">é¹¿ä¹ƒ (Kano)</p>
            
            <div class="song-meta">
                <div class="word-count">
                    <div id="totalWords">58</div>
                    <span>ì´ ê°€ì‚¬ ìˆ˜</span>
                </div>
                <div class="emotion-keywords">
                    <span class="keyword-tag">ê³ ë…</span>
                    <span class="keyword-tag">ìœ„ë¡œ</span>
                    <span class="keyword-tag">ì•„ì¹¨</span>
                    <span class="keyword-tag">ëˆˆë¬¼</span>
                    <span class="keyword-tag">ê°ì‚¬</span>
                </div>
            </div>
        </header>

        <div class="filter-controls">
            <div class="filter-toggle">
                <label for="filterKnown">ì•„ëŠ” ë‹¨ì–´ ì œì™¸</label>
                <div class="toggle-switch" id="filterToggle"></div>
            </div>
        </div>

        <div class="lyrics-container" id="lyricsContainer"></div>

        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="statBookmarks">0</div>
                <div class="stat-label">ë¶ë§ˆí¬</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="statProgress">0%</div>
                <div class="stat-label">í•™ìŠµ ì§„í–‰ë¥ </div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="statKnown">0</div>
                <div class="stat-label">ì•„ëŠ” ë‹¨ì–´</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="statLastStudy">-</div>
                <div class="stat-label">ìµœê·¼ í•™ìŠµ</div>
            </div>
        </div>
    </div>

    <script>
        // ê°€ì‚¬ ë°ì´í„° (ìë§‰ íŒŒì¼ ê¸°ë°˜ ì •í™•í•œ íƒ€ì„ìŠ¤íƒ¬í”„)
        const songData = {
            "song_title": "ãƒãƒ­ï¼ãƒãƒ¯ãƒ¦",
            "artist": "é¹¿ä¹ƒ",
            "emotion_keywords": ["ê³ ë…", "ìœ„ë¡œ", "ì•„ì¹¨", "ëˆˆë¬¼", "ê°ì‚¬"],
            "lyrics": [
                { "id": 1, "timestamp": 20, "jp": "ãƒãƒ­ çª“ã‚’é–‹ã‘ã¦å°ã•ãå‘Ÿã„ãŸ", "reading": "ãƒãƒ­ ã¾ã©ã‚’ã‚ã‘ã¦ ã¡ã„ã•ãã¤ã¶ã‚„ã„ãŸ", "romanized": "Haro mado wo akete chiisaku tsubuyaita", "kr": "Hello ì°½ë¬¸ì„ ì—´ê³  ì‘ê²Œ ì¤‘ì–¼ê±°ë ¸ì–´" },
                { "id": 2, "timestamp": 20, "jp": "ãƒãƒ¯ãƒ¦ èª°ã‚‚ã„ãªã„éƒ¨å±‹ã§ä¸€äºº", "reading": "ãƒãƒ¯ãƒ¦ ã ã‚Œã‚‚ã„ãªã„ ã¸ã‚„ã§ ã²ã¨ã‚Š", "romanized": "Hawayu dare mo inai heya de hitori", "kr": "How are you ì•„ë¬´ë„ ì—†ëŠ” ë°©ì—ì„œ í˜¼ì" },
                { "id": 3, "timestamp": 33, "jp": "ãƒ¢ãƒ¼ãƒ‹ãƒ³ æœãŒæ¥ãŸã‚ˆ åœŸç ‚é™ã‚Šã®æœãŒ", "reading": "ãƒ¢ãƒ¼ãƒ‹ãƒ³ ã‚ã•ãŒããŸã‚ˆ ã©ã—ã‚ƒã¶ã‚Šã® ã‚ã•ãŒ", "romanized": "MÅnin asa ga kita yo doshaburi no asa ga", "kr": "Morning ì•„ì¹¨ì´ ì™”ì–´ ë¹„ê°€ ìŸì•„ì§€ëŠ” ì•„ì¹¨ì´" },
                { "id": 4, "timestamp": 33, "jp": "ãƒ†ã‚£ã‚¯ã‚¿ã‚¯ ç§ã®ãƒã‚¸ã‚’èª°ã‹å·»ã„ã¦", "reading": "ãƒ†ã‚£ã‚¯ã‚¿ã‚¯ ã‚ãŸã—ã®ã­ã˜ã‚’ ã ã‚Œã‹ ã¾ã„ã¦", "romanized": "Tikutaku watashi no neji wo dareka maite", "kr": "Tic Tac ë‚˜ì˜ íƒœì—½ì„ ëˆ„êµ°ê°€ ê°ì•„ì¤˜" },
                { "id": 4.5, "timestamp": 50, "jp": "â™ª é–“å¥ â™ª", "reading": "ã‹ã‚“ãã†", "romanized": "KansÅ", "kr": "ğŸµ ê°„ì£¼ ì¤‘ ğŸµ" },
                { "id": 5, "timestamp": 60, "jp": "ãƒãƒ­ æ˜”ã®ã‚¢ãƒ‹ãƒ¡ã«ãã‚“ãªã®ã„ãŸã£ã‘ãª", "reading": "ãƒãƒ­ ã‚€ã‹ã—ã®ã‚¢ãƒ‹ãƒ¡ã« ãã‚“ãªã® ã„ãŸã£ã‘ãª", "romanized": "Haro mukashi no anime ni sonna no itakke na", "kr": "Hello ì˜›ë‚  ì• ë‹ˆë©”ì´ì…˜ì— ê·¸ëŸ° ê±° ìˆì—ˆë˜ê°€" },
                { "id": 6, "timestamp": 60, "jp": "ãƒãƒ¯ãƒ¦ ç¾¨ã¾ã—ã„ãª ã¿ã‚“ãªã«æ„›ã•ã‚Œã¦", "reading": "ãƒãƒ¯ãƒ¦ ã†ã‚‰ã‚„ã¾ã—ã„ãª ã¿ã‚“ãªã« ã‚ã„ã•ã‚Œã¦", "romanized": "Hawayu urayamashii na minna ni aisarete", "kr": "How are you ë¶€ëŸ½ë„¤, ëª¨ë‘ì—ê²Œ ì‚¬ë‘ë°›ì•„ì„œ" },
                { "id": 7, "timestamp": 71, "jp": "ã‚¹ãƒªãƒ¼ãƒ”ãƒ³ ãƒã‚«ãªäº‹è¨€ã£ã¦ãªã„ã§ æ”¯åº¦ã‚’ã—ãªãã¡ã‚ƒ", "reading": "ã‚¹ãƒªãƒ¼ãƒ”ãƒ³ ãƒã‚«ãªã“ã¨ ã„ã£ã¦ãªã„ã§ ã—ãŸãã‚’ ã—ãªãã¡ã‚ƒ", "romanized": "SurÄ«pin baka na koto ittenaide shitaku wo shinakucha", "kr": "Sleeping ë°”ë³´ ê°™ì€ ì†Œë¦¬ í•˜ì§€ ë§ê³  ì¤€ë¹„í•´ì•¼ì§€" },
                { "id": 8, "timestamp": 71, "jp": "ã‚¯ãƒ©ã‚¤ãƒ³ æ¶™ã®è·¡ã‚’éš ã™ãŸã‚ ã‚‚ã†", "reading": "ã‚¯ãƒ©ã‚¤ãƒ³ ãªã¿ã ã®ã‚ã¨ã‚’ ã‹ãã™ãŸã‚ ã‚‚ã†", "romanized": "Kurain namida no ato wo kakusu tame mÅ", "kr": "Crying ëˆˆë¬¼ì˜ í”ì ì„ ê°ì¶”ê¸° ìœ„í•´ ì´ì œ" },
                { "id": 9, "timestamp": 81, "jp": "å£ç™–ã«ãªã£ãŸã€Œã¾ãã„ã£ã‹ã€", "reading": "ãã¡ãã›ã« ãªã£ãŸ ã€Œã¾ãã„ã£ã‹ã€", "romanized": "Kuchiguse ni natta 'MÄ ikka'", "kr": "ì…ë²„ë¦‡ì´ ë˜ì–´ë²„ë¦° \"ë­, ëì–´\"" },
                { "id": 10, "timestamp": 81, "jp": "æ˜¨æ—¥ã®è¨€è‘‰ãŒãµã¨é ­ã‚’ã‚ˆãã‚‹", "reading": "ãã®ã†ã® ã“ã¨ã°ãŒ ãµã¨ ã‚ãŸã¾ã‚’ ã‚ˆãã‚‹", "romanized": "KinÅ no kotoba ga futo atama wo yogiru", "kr": "ì–´ì œì˜ ë§ì´ ë¬¸ë“ ë¨¸ë¦¿ì†ì„ ìŠ¤ì³ ì§€ë‚˜ê°€" },
                { "id": 11, "timestamp": 81, "jp": "ã€Œã‚‚ã†å›ã«ã¯å…¨ç„¶æœŸå¾…ã—ã¦ãªã„ã‹ã‚‰ã€", "reading": "ã€Œã‚‚ã† ãã¿ã«ã¯ ãœã‚“ãœã‚“ ããŸã„ ã—ã¦ãªã„ ã‹ã‚‰ã€", "romanized": "'MÅ kimi niwa zenzen kitai shitenai kara'", "kr": "\"ë” ì´ìƒ ë„ˆí•œí…ŒëŠ” ì „í˜€ ê¸°ëŒ€í•˜ì§€ ì•Šìœ¼ë‹ˆê¹Œ\"" },
                { "id": 12, "timestamp": 91, "jp": "ãã‚Šã‚ƒã¾ã‚ç§ã ã£ã¦è‡ªåˆ†ã«æœŸå¾…ãªã©ã—ã¦ãªã„ã‘ã‚Œã©", "reading": "ãã‚Šã‚ƒã¾ã‚ ã‚ãŸã—ã ã£ã¦ ã˜ã¶ã‚“ã« ããŸã„ ãªã© ã—ã¦ãªã„ ã‘ã‚Œã©", "romanized": "Sorya maa watashi datte jibun ni kitai nado shitenai keredo", "kr": "ë­ ë‚˜ë„ ë‚˜ ìì‹ ì—ê²Œ ê¸°ëŒ€ ê°™ì€ ê±´ í•˜ì§€ ì•Šì§€ë§Œ" },
                { "id": 13, "timestamp": 91, "jp": "ã‚ã‚Œã¯ä¸€ä½“ã©ã†ã„ã†ã¤ã‚‚ã‚Šã§ã™ã‹", "reading": "ã‚ã‚Œã¯ ã„ã£ãŸã„ ã©ã†ã„ã† ã¤ã‚‚ã‚Š ã§ã™ã‹", "romanized": "Are wa ittai dÅ iu tsumori desu ka", "kr": "ê·¸ê±´ ë„ëŒ€ì²´ ë¬´ìŠ¨ ì˜ë¯¸ì¸ê°€ìš”" },
                { "id": 14, "timestamp": 101, "jp": "å–‰å…ƒã¾ã§å‡ºã‹ã‹ã£ãŸè¨€è‘‰", "reading": "ã®ã©ã‚‚ã¨ã¾ã§ ã§ã‹ã‹ã£ãŸ ã“ã¨ã°", "romanized": "Nodomoto made dekakatta kotoba", "kr": "ëª©êµ¬ë©ê¹Œì§€ ë‚˜ì™”ë˜ ë§ì€" },
                { "id": 15, "timestamp": 101, "jp": "å£ã‚’ã¤ã„ã¦å‡ºãŸã®ã¯å˜˜", "reading": "ãã¡ã‚’ ã¤ã„ã¦ ã§ãŸã®ã¯ ã†ã", "romanized": "Kuchi wo tsuite deta no wa uso", "kr": "ì… ë°–ì— ë‚˜ì˜¨ ê±´ ê±°ì§“ë§" },
                { "id": 16, "timestamp": 111, "jp": "ã“ã†ã—ã¦ä»Šæ—¥ã‚‚ç§ã¯", "reading": "ã“ã†ã—ã¦ ãã‚‡ã†ã‚‚ ã‚ãŸã—ã¯", "romanized": "KÅshite kyÅ mo watashi wa", "kr": "ì´ë ‡ê²Œ ì˜¤ëŠ˜ë„ ë‚˜ëŠ”" },
                { "id": 17, "timestamp": 111, "jp": "è²´é‡ãªè¨€è‘‰ã‚’æµªè²»ã—ã¦ç”Ÿãã¦ã‚†ã", "reading": "ãã¡ã‚‡ã†ãª ã“ã¨ã°ã‚’ ã‚ã†ã²ã—ã¦ ã„ãã¦ã‚†ã", "romanized": "KichÅ na kotoba wo rÅhi shite ikite yuku", "kr": "ì†Œì¤‘í•œ ë§ì„ ë‚­ë¹„í•˜ë©° ì‚´ì•„ê°€ë„¤" },
                { "id": 18, "timestamp": 121, "jp": "ãªãœéš ã—ã¦ã—ã¾ã†ã®ã§ã™ã‹", "reading": "ãªãœ ã‹ãã—ã¦ ã—ã¾ã†ã®ã§ã™ã‹", "romanized": "Naze kakushite shimau no desu ka", "kr": "ì™œ ìˆ¨ê²¨ë²„ë¦¬ëŠ” ê±´ê°€ìš”" },
                { "id": 19, "timestamp": 121, "jp": "ç¬‘ã‚ã‚Œã‚‹ã®ãŒæ€–ã„ã®ã§ã™ã‹", "reading": "ã‚ã‚‰ã‚ã‚Œã‚‹ã®ãŒ ã“ã‚ã„ã®ã§ã™ã‹", "romanized": "Warawareru no ga kowai no desu ka", "kr": "ë¹„ì›ƒìŒë‹¹í•˜ëŠ” ê²Œ ë¬´ì„œìš´ ê±´ê°€ìš”" },
                { "id": 20, "timestamp": 121, "jp": "èª°ã«ã‚‚ä¼šã„ãŸããªã„ã®ã§ã™ã‹", "reading": "ã ã‚Œã«ã‚‚ ã‚ã„ãŸããªã„ã®ã§ã™ã‹", "romanized": "Dare nimo aitakunai no desu ka", "kr": "ëˆ„êµ¬ì™€ë„ ë§Œë‚˜ê³  ì‹¶ì§€ ì•Šì€ ê±´ê°€ìš”" },
                { "id": 21, "timestamp": 121, "jp": "ãã‚Œæœ¬å½“ã§ã™ã‹", "reading": "ãã‚Œ ã»ã‚“ã¨ã† ã§ã™ã‹", "romanized": "Sore hontÅ desu ka", "kr": "ê·¸ê±° ì •ë§ì¸ê°€ìš”" },
                { "id": 22, "timestamp": 132, "jp": "æ›–æ˜§ã¨ã„ã†åã®æµ·ã«æººã‚Œã¦", "reading": "ã‚ã„ã¾ã„ ã¨ã„ã† ãªã® ã†ã¿ã« ãŠã¼ã‚Œã¦", "romanized": "Aimai to iu na no umi ni oborete", "kr": "'ì• ë§¤í•¨'ì´ë¼ëŠ” ì´ë¦„ì˜ ë°”ë‹¤ì— ë¹ ì ¸" },
                { "id": 23, "timestamp": 132, "jp": "æ¯ã‚‚ã§ããªã„ã»ã©è‹¦ã—ã„ã®", "reading": "ã„ãã‚‚ ã§ããªã„ ã»ã© ãã‚‹ã—ã„ã®", "romanized": "Iki mo dekinai hodo kurushii no", "kr": "ìˆ¨ë„ ì‰´ ìˆ˜ ì—†ì„ ë§Œí¼ ê´´ë¡œìš´ë°" },
                { "id": 24, "timestamp": 132, "jp": "å°‘ã—å£°ãŒèããŸããªã‚Šã¾ã—ãŸ", "reading": "ã™ã“ã— ã“ãˆãŒ ãããŸã ãªã‚Šã¾ã—ãŸ", "romanized": "Sukoshi koe ga kikitaku narimashita", "kr": "ì¡°ê¸ˆ ëª©ì†Œë¦¬ê°€ ë“£ê³  ì‹¶ì–´ì¡ŒìŠµë‹ˆë‹¤" },
                { "id": 25, "timestamp": 132, "jp": "æœ¬å½“ã«å¼±ã„ãª", "reading": "ã»ã‚“ã¨ã†ã« ã‚ˆã‚ã„ãª", "romanized": "HontÅ ni yowai na", "kr": "ì •ë§ ì•½í•˜ë„¤" },
                { "id": 26, "timestamp": 161, "jp": "ä¸€å‘ã«é€²ã¾ãªã„æ”¯åº¦ã®é€”ä¸­", "reading": "ã„ã£ã“ã†ã« ã™ã™ã¾ãªã„ ã—ãŸãã® ã¨ã¡ã‚…ã†", "romanized": "IkkÅ ni susumanai shitaku no tochÅ«", "kr": "ì „í˜€ ì§„ì²™ë˜ì§€ ì•ŠëŠ” ì¤€ë¹„ ë„ì¤‘ì—" },
                { "id": 27, "timestamp": 161, "jp": "æœ¦æœ§ã¨ã—ãŸé ­ã§æ€ã†", "reading": "ã‚‚ã†ã‚ã†ã¨ã—ãŸ ã‚ãŸã¾ã§ ãŠã‚‚ã†", "romanized": "MÅrÅ to shita atama de omou", "kr": "ëª½ë¡±í•´ì§„ ë¨¸ë¦¬ë¡œ ìƒê°í•´" },
                { "id": 28, "timestamp": 161, "jp": "ã€Œã‚‚ã†ç†ç”±ã‚’ã¤ã‘ã¦ä¼‘ã‚“ã§ã—ã¾ãŠã†ã‹ãªã€", "reading": "ã€Œã‚‚ã† ã‚Šã‚†ã†ã‚’ ã¤ã‘ã¦ ã‚„ã™ã‚“ã§ ã—ã¾ãŠã†ã‹ãªã€", "romanized": "'MÅ riyÅ« wo tsukete yasunde shimaou kana'", "kr": "\"ì´ì œ ì•„ë¬´ ì´ìœ ë‚˜ ëŒ€ê³  ì‰¬ì–´ë²„ë¦´ê¹Œ\"" },
                { "id": 29, "timestamp": 161, "jp": "ã„ã‚„ã„ã‚„åˆ†ã‹ã£ã¦ã¾ã™ã£ã¦", "reading": "ã„ã‚„ã„ã‚„ ã‚ã‹ã£ã¦ã¾ã™ã£ã¦", "romanized": "Iya iya wakatte masu tte", "kr": "ì•„ëƒ, ì•„ëƒ, ì•Œê³  ìˆë‹¤ë‹ˆê¹Œ" },
                { "id": 30, "timestamp": 161, "jp": "ãªã‚“ã¨ãªãè¨€ã£ã¦ã¿ãŸã ã‘ã ã‚ˆ", "reading": "ãªã‚“ã¨ãªã ã„ã£ã¦ã¿ãŸ ã ã‘ã ã‚ˆ", "romanized": "Nantonaku itte mita dake da yo", "kr": "ê·¸ëƒ¥ ë¬´ì‹¬ì½” ë§í•´ë³¸ ê²ƒë¿ì´ì•¼" },
                { "id": 31, "timestamp": 161, "jp": "åˆ†ã‹ã£ã¦ã‚‹ã‹ã‚‰æ€’ã‚‰ãªã„ã§ã‚ˆ", "reading": "ã‚ã‹ã£ã¦ã‚‹ã‹ã‚‰ ãŠã“ã‚‰ãªã„ã§ã‚ˆ", "romanized": "Wakatteru kara okoranaide yo", "kr": "ì•Œê³  ìˆìœ¼ë‹ˆê¹Œ í™”ë‚´ì§€ ë§ì•„ìš”" },
                { "id": 32, "timestamp": 177, "jp": "å¹¸ã›ã ã‚ã†ã¨ä¸å¹¸ã›ã ã‚ã†ã¨", "reading": "ã—ã‚ã‚ã›ã ã‚ã†ã¨ ãµã—ã‚ã‚ã›ã ã‚ã†ã¨", "romanized": "Shiawase darÅ to fushiawase darÅ to", "kr": "í–‰ë³µí•˜ë“  ë¶ˆí–‰í•˜ë“ " },
                { "id": 33, "timestamp": 177, "jp": "å¹³ç­‰ã«æ®‹é…·ã«æœæ—¥ã¯æ˜‡ã‚‹", "reading": "ã³ã‚‡ã†ã©ã†ã« ã–ã‚“ã“ãã« ã‚ã•ã²ã¯ ã®ã¼ã‚‹", "romanized": "ByÅdÅ ni zankoku ni asahi wa noboru", "kr": "í‰ë“±í•˜ê²Œ ì”í˜¹í•˜ê²Œ ì•„ì¹¨ í•´ëŠ” ë– ì˜¬ë¼" },
                { "id": 34, "timestamp": 177, "jp": "ç”Ÿãã¦ã„ãã ã‘ã§ç²¾ä¸€æ¯ã®ç§ã«", "reading": "ã„ãã¦ã„ã ã ã‘ã§ ã›ã„ã„ã£ã±ã„ã® ã‚ãŸã—ã«", "romanized": "Ikite iku dake de sei-ippai no watashi ni", "kr": "ì‚´ì•„ê°€ëŠ” ê²ƒë§Œìœ¼ë¡œ ë²…ì°¬ ë‚˜ì—ê²Œ" },
                { "id": 35, "timestamp": 182, "jp": "ã“ã‚Œä»¥ä¸Šä½•ã‚’æœ›ã‚€ã¨ã„ã†ã®", "reading": "ã“ã‚Œã„ã˜ã‚‡ã† ãªã«ã‚’ ã®ãã‚€ã¨ ã„ã†ã®", "romanized": "Kore ijÅ nani wo nozomu to iu no", "kr": "ì´ ì´ìƒ ë¬´ì—‡ì„ ë°”ë¼ë¼ëŠ” ê±´ê°€ìš”" },
                { "id": 36, "timestamp": 192, "jp": "ãªãœæ°—ã«ã—ã¦ã—ã¾ã†ã®ã§ã™ã‹", "reading": "ãªãœ ãã«ã—ã¦ ã—ã¾ã†ã®ã§ã™ã‹", "romanized": "Naze ki ni shite shimau no desu ka", "kr": "ì™œ ì‹ ê²½ ì¨ë²„ë¦¬ëŠ” ê±´ê°€ìš”" },
                { "id": 37, "timestamp": 192, "jp": "æœ¬å½“ã¯æ„›ã•ã‚ŒãŸã„ã®ã§ã™ã‹", "reading": "ã»ã‚“ã¨ã†ã¯ ã‚ã„ã•ã‚ŒãŸã„ã®ã§ã™ã‹", "romanized": "HontÅ wa aisaretai no desu ka", "kr": "ì‚¬ì‹¤ì€ ì‚¬ë‘ë°›ê³  ì‹¶ì€ ê±´ê°€ìš”" },
                { "id": 38, "timestamp": 192, "jp": "ãã®æ‰‹ã‚’é›¢ã—ãŸã®ã¯èª°ã§ã™ã‹", "reading": "ãã®ã¦ã‚’ ã¯ãªã—ãŸã®ã¯ ã ã‚Œã§ã™ã‹", "romanized": "Sono te wo hanashita no wa dare desu ka", "kr": "ê·¸ ì†ì„ ë†“ì€ ê±´ ëˆ„êµ¬ì¸ê°€ìš”" },
                { "id": 39, "timestamp": 192, "jp": "æ°—ãŒã¤ã„ã¦ã„ã¾ã™ã‹", "reading": "ããŒ ã¤ã„ã¦ã„ã¾ã™ã‹", "romanized": "Ki ga tsuite imasu ka", "kr": "ê¹¨ë‹«ê³  ìˆë‚˜ìš”" },
                { "id": 40, "timestamp": 202, "jp": "äººç”Ÿã«ã‚¿ã‚¤ãƒ ã‚«ãƒ¼ãƒ‰ãŒã‚ã‚‹ãªã‚‰", "reading": "ã˜ã‚“ã›ã„ã« ã‚¿ã‚¤ãƒ ã‚«ãƒ¼ãƒ‰ãŒ ã‚ã‚‹ãªã‚‰", "romanized": "Jinsei ni taimu kÄdo ga aru nara", "kr": "ì¸ìƒì— íƒ€ì„ì¹´ë“œê°€ ìˆë‹¤ë©´" },
                { "id": 41, "timestamp": 202, "jp": "çµ‚ã‚ã‚Šã®æ™‚é–“ã¯ä½•æ™‚ãªã‚“ã ã‚ã†", "reading": "ãŠã‚ã‚Šã® ã˜ã‹ã‚“ã¯ ãªã‚“ã˜ ãªã‚“ã ã‚ã†", "romanized": "Owari no jikan wa nanji nan darÅ", "kr": "ëë‚˜ëŠ” ì‹œê°„ì€ ëª‡ ì‹œì¼ê¹Œìš”" },
                { "id": 42, "timestamp": 202, "jp": "ç§ãŒç”ŸããŸåˆ†ã®çµ¦æ–™ã¯", "reading": "ã‚ãŸã—ãŒ ã„ããŸ ã¶ã‚“ã® ãã‚…ã†ã‚Šã‚‡ã†ã¯", "romanized": "Watashi ga ikita bun no kyÅ«ryÅ wa", "kr": "ë‚´ê°€ ì‚´ì•„ì˜¨ ë§Œí¼ì˜ ê¸‰ë£ŒëŠ”" },
                { "id": 43, "timestamp": 202, "jp": "èª°ãŒæ‰•ã†ã‚“ã§ã™ã‹", "reading": "ã ã‚ŒãŒ ã¯ã‚‰ã†ã‚“ã§ã™ã‹", "romanized": "Dare ga haraun desu ka", "kr": "ëˆ„ê°€ ì§€ë¶ˆí•˜ëŠ” ê±´ê°€ìš”" },
                { "id": 43.5, "timestamp": 211, "jp": "â™ª é–“å¥ â™ª", "reading": "ã‹ã‚“ãã†", "romanized": "KansÅ", "kr": "ğŸµ ê°„ì£¼ ì¤‘ ğŸµ" },
                { "id": 44, "timestamp": 226, "jp": "ã‚µãƒ³ã‚­ãƒ¥ãƒ¼ ã‚ã‚ŠãŒã¨ã†ã£ã¦è¨€ã„ãŸã„ã®", "reading": "ã‚µãƒ³ã‚­ãƒ¥ãƒ¼ ã‚ã‚ŠãŒã¨ã†ã£ã¦ ã„ã„ãŸã„ã®", "romanized": "SankyÅ« arigatÅ tte iitai no", "kr": "Thank you ê³ ë§™ë‹¤ê³  ë§í•˜ê³  ì‹¶ì–´" },
                { "id": 45, "timestamp": 226, "jp": "ã‚µãƒ³ã‚­ãƒ¥ãƒ¼ ã‚ã‚ŠãŒã¨ã†ã£ã¦è¨€ã„ãŸã„ã‚ˆ", "reading": "ã‚µãƒ³ã‚­ãƒ¥ãƒ¼ ã‚ã‚ŠãŒã¨ã†ã£ã¦ ã„ã„ãŸã„ã‚ˆ", "romanized": "SankyÅ« arigatÅ tte iitai yo", "kr": "Thank you ê³ ë§™ë‹¤ê³  ë§í•˜ê³  ì‹¶ì–´ìš”" },
                { "id": 46, "timestamp": 226, "jp": "ã‚µãƒ³ã‚­ãƒ¥ãƒ¼ ä¸€åº¦ã ã‘ã§ã‚‚ã„ã„ã‹ã‚‰", "reading": "ã‚µãƒ³ã‚­ãƒ¥ãƒ¼ ã„ã¡ã©ã ã‘ã§ã‚‚ ã„ã„ã‹ã‚‰", "romanized": "SankyÅ« ichido dake demo ii kara", "kr": "Thank you ë‹¨ í•œ ë²ˆë§Œì´ë¼ë„ ì¢‹ìœ¼ë‹ˆê¹Œ" },
                { "id": 47, "timestamp": 235, "jp": "å¿ƒã®åº•ã‹ã‚‰å¤§æ³£ãã—ãªãŒã‚‰", "reading": "ã“ã“ã‚ã® ãã“ã‹ã‚‰ ãŠãŠãªã ã—ãªãŒã‚‰", "romanized": "Kokoro no soko kara Ånaki shinagara", "kr": "ë§ˆìŒì† ê¹Šì€ ê³³ì—ì„œ ëª© ë†“ì•„ ìš¸ë©´ì„œ" },
                { "id": 48, "timestamp": 235, "jp": "ã‚ã‚ŠãŒã¨ã†ã£ã¦è¨€ã„ãŸã„ã®", "reading": "ã‚ã‚ŠãŒã¨ã†ã£ã¦ ã„ã„ãŸã„ã®", "romanized": "ArigatÅ tte iitai no", "kr": "ê³ ë§™ë‹¤ê³  ë§í•˜ê³  ì‹¶ì–´" },
                { "id": 49, "timestamp": 244, "jp": "ãªãœéš ã—ã¦ã—ã¾ã†ã®ã§ã™ã‹", "reading": "ãªãœ ã‹ãã—ã¦ ã—ã¾ã†ã®ã§ã™ã‹", "romanized": "Naze kakushite shimau no desu ka", "kr": "ì™œ ìˆ¨ê²¨ë²„ë¦¬ëŠ” ê±´ê°€ìš”" },
                { "id": 50, "timestamp": 244, "jp": "æœ¬å½“ã¯èã„ã¦ã»ã—ã„ã®ã§ã™ã‹", "reading": "ã»ã‚“ã¨ã†ã¯ ãã„ã¦ ã»ã—ã„ã®ã§ã™ã‹", "romanized": "HontÅ wa kiite hoshii no desu ka", "kr": "ì‚¬ì‹¤ì€ ë“¤ì–´ì£¼ê¸¸ ë°”ë¼ëŠ” ê±´ê°€ìš”" },
                { "id": 51, "timestamp": 244, "jp": "çµ¶å¯¾ã«ç¬‘ã£ãŸã‚Šã—ãªã„ã‹ã‚‰", "reading": "ãœã£ãŸã„ã« ã‚ã‚‰ã£ãŸã‚Š ã—ãªã„ã‹ã‚‰", "romanized": "Zettai ni warattari shinai kara", "kr": "ì ˆëŒ€ë¡œ ë¹„ì›ƒê±°ë‚˜ í•˜ì§„ ì•Šì„ í…Œë‹ˆ" },
                { "id": 52, "timestamp": 244, "jp": "è©±ã—ã¦ã¿ã¾ã›ã‚“ã‹", "reading": "ã¯ãªã—ã¦ ã¿ã¾ã›ã‚“ã‹", "romanized": "Hanashite mimasen ka", "kr": "ì´ì•¼ê¸°í•´ ë³´ì§€ ì•Šê² ì–´ìš”" },
                { "id": 53, "timestamp": 255, "jp": "å£ã‚’é–‹ã‹ãªã‘ã‚Œã°åˆ†ã‹ã‚‰ãªã„", "reading": "ãã¡ã‚’ ã‚ã‹ãªã‘ã‚Œã° ã‚ã‹ã‚‰ãªã„", "romanized": "Kuchi wo akanakereba wakaranai", "kr": "ì…ì„ ì—´ì§€ ì•Šìœ¼ë©´ ì•Œ ìˆ˜ ì—†ì–´" },
                { "id": 54, "timestamp": 255, "jp": "æ€ã£ã¦ã‚‹ã ã‘ã§ã¯ä¼ã‚ã‚‰ãªã„", "reading": "ãŠã‚‚ã£ã¦ã‚‹ ã ã‘ã§ã¯ ã¤ãŸã‚ã‚‰ãªã„", "romanized": "Omotteru dake dewa tsutawaranai", "kr": "ìƒê°ë§Œìœ¼ë¡œëŠ” ì „í•´ì§€ì§€ ì•Šì•„" },
                { "id": 55, "timestamp": 255, "jp": "ãªã‚“ã¦é¢å€’ãã•ã„ç”Ÿãç‰©ã§ã—ã‚‡ã†", "reading": "ãªã‚“ã¦ ã‚ã‚“ã©ã†ãã•ã„ ã„ãã‚‚ã® ã§ã—ã‚‡ã†", "romanized": "Nante mendÅkusai ikimono deshÅ", "kr": "ì •ë§ ê·€ì°®ì€ ìƒë¬¼ì´ì£ " },
                { "id": 56, "timestamp": 255, "jp": "äººé–“ã¨ã„ã†ã®ã¯", "reading": "ã«ã‚“ã’ã‚“ ã¨ã„ã†ã®ã¯", "romanized": "Ningen to iu no wa", "kr": "ì¸ê°„ì´ë¼ëŠ” ê±´" },
                { "id": 57, "timestamp": 277, "jp": "ãƒãƒ­ ãƒãƒ¯ãƒ¦", "reading": "ãƒãƒ­ ãƒãƒ¯ãƒ¦", "romanized": "Haro Hawayu", "kr": "Hello How are you" }
            ]
        };

        // DOM ìš”ì†Œ
        const audio = document.getElementById('audioPlayer');
        const playBtn = document.getElementById('playBtn');
        const progressBar = document.getElementById('progressBar');
        const progressFill = document.getElementById('progressFill');
        const currentTimeEl = document.getElementById('currentTime');
        const durationEl = document.getElementById('duration');
        const volumeSlider = document.getElementById('volumeSlider');
        const audioFile = document.getElementById('audioFile');
        const uploadZone = document.getElementById('uploadZone');
        const fileName = document.getElementById('fileName');

        // ìƒíƒœ
        let expandedLines = new Set();
        let bookmarkedLines = new Set();
        let knownWords = new Set();
        let filterKnownWords = false;
        let currentActiveLine = null;

        const STORAGE_KEY = {
            bookmarks: 'bookmarks_hello_how_are_you',
            known: 'known_words_hello_how_are_you',
            lastStudy: 'last_study_date_hello_how_are_you'
        };

        // ì´ˆê¸°í™”
        function init() {
            loadFromStorage();
            renderLyrics();
            updateStats();
            attachEventListeners();
            setupAudioListeners();
        }

        // ì˜¤ë””ì˜¤ íŒŒì¼ ì—…ë¡œë“œ
        audioFile.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    const audioData = event.target.result;
                    
                    // localStorageì— ì €ì¥ (ìµœëŒ€ 5MBê¹Œì§€ë§Œ)
                    try {
                        if (audioData.length < 5 * 1024 * 1024) {
                            localStorage.setItem('savedAudioData', audioData);
                            localStorage.setItem('savedAudioName', file.name);
                            console.log('âœ… ì˜¤ë””ì˜¤ íŒŒì¼ ì €ì¥ë¨:', file.name);
                        } else {
                            console.warn('âš ï¸ íŒŒì¼ì´ ë„ˆë¬´ ì»¤ì„œ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤ (5MB ì´ìƒ)');
                        }
                    } catch (e) {
                        console.warn('âš ï¸ ì €ì¥ ì‹¤íŒ¨:', e);
                    }
                    
                    // ì˜¤ë””ì˜¤ ë¡œë“œ
                    loadAudioFromData(audioData, file.name);
                };
                
                reader.readAsDataURL(file);
            }
        });

        // ì˜¤ë””ì˜¤ ë°ì´í„°ë¡œë¶€í„° ë¡œë“œí•˜ëŠ” í•¨ìˆ˜
        function loadAudioFromData(audioData, name) {
            audio.src = audioData;
            fileName.textContent = `âœ… ${name}`;
            uploadZone.classList.add('has-file');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ ì˜¤ë””ì˜¤ ìë™ ë³µì›
        window.addEventListener('DOMContentLoaded', function() {
            const savedAudioData = localStorage.getItem('savedAudioData');
            const savedAudioName = localStorage.getItem('savedAudioName');
            
            if (savedAudioData && savedAudioName) {
                console.log('ğŸ“‚ ì €ì¥ëœ ì˜¤ë””ì˜¤ ë¶ˆëŸ¬ì˜¤ê¸°:', savedAudioName);
                loadAudioFromData(savedAudioData, savedAudioName);
            }
        });

        // ì˜¤ë””ì˜¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        function setupAudioListeners() {
            // ì¬ìƒ/ì¼ì‹œì •ì§€
            playBtn.addEventListener('click', () => {
                if (audio.paused) {
                    audio.play();
                    playBtn.textContent = 'â¸ï¸';
                } else {
                    audio.pause();
                    playBtn.textContent = 'â–¶ï¸';
                }
            });

            // ë³¼ë¥¨
            volumeSlider.addEventListener('input', (e) => {
                audio.volume = e.target.value / 100;
            });
            audio.volume = 0.7;

            // ì¬ìƒ ì‹œê°„ ì—…ë°ì´íŠ¸
            audio.addEventListener('timeupdate', () => {
                const current = audio.currentTime;
                const duration = audio.duration;

                if (duration) {
                    const percent = (current / duration) * 100;
                    progressFill.style.width = percent + '%';
                    currentTimeEl.textContent = formatTime(current);
                    
                    // ê°€ì‚¬ ì‹±í¬
                    highlightCurrentLyric(current);
                }
            });

            // ì´ ì¬ìƒì‹œê°„
            audio.addEventListener('loadedmetadata', () => {
                durationEl.textContent = formatTime(audio.duration);
            });

            // í”„ë¡œê·¸ë ˆìŠ¤ ë°” í´ë¦­
            progressBar.addEventListener('click', (e) => {
                const rect = progressBar.getBoundingClientRect();
                const percent = (e.clientX - rect.left) / rect.width;
                audio.currentTime = percent * audio.duration;
            });
        }

        // ê°€ì‚¬ í•˜ì´ë¼ì´íŠ¸ (ê°™ì€ timestampì˜ ëª¨ë“  ì¤„ì„ ë™ì‹œì— í‘œì‹œ)
        function highlightCurrentLyric(currentTime) {
            // 1. í˜„ì¬ í™œì„±í™”ë˜ì–´ì•¼ í•  timestamp ì°¾ê¸°
            let currentTimestamp = null;
            
            for (let i = 0; i < songData.lyrics.length; i++) {
                const lyric = songData.lyrics[i];
                const prevLyric = songData.lyrics[i - 1];
                
                const startTime = prevLyric ? prevLyric.timestamp : 0;
                const endTime = lyric.timestamp;
                
                if (currentTime > startTime && currentTime <= endTime) {
                    currentTimestamp = lyric.timestamp;
                    break;
                }
            }

            // 2. í•´ë‹¹ timestampë¥¼ ê°€ì§„ ëª¨ë“  ì¤„ ì°¾ê¸°
            const activeLineIds = [];
            if (currentTimestamp !== null) {
                songData.lyrics.forEach(lyric => {
                    if (lyric.timestamp === currentTimestamp) {
                        activeLineIds.push(lyric.id);
                    }
                });
            }

            // 3. ëª¨ë“  ê°€ì‚¬ ì¤„ì˜ í•˜ì´ë¼ì´íŠ¸ ì œê±°
            document.querySelectorAll('.lyric-line').forEach(line => {
                line.classList.remove('active');
            });

            // 4. í™œì„±í™”ë˜ì–´ì•¼ í•  ì¤„ë“¤ë§Œ í•˜ì´ë¼ì´íŠ¸
            if (activeLineIds.length > 0) {
                let shouldScroll = !currentActiveLine || !activeLineIds.includes(currentActiveLine);
                
                activeLineIds.forEach((lineId, index) => {
                    const line = document.querySelector(`.lyric-line[data-id="${lineId}"]`);
                    if (line) {
                        line.classList.add('active');
                        
                        // ì²« ë²ˆì§¸ ì¤„ë¡œ ìŠ¤í¬ë¡¤ (í•œ ë²ˆë§Œ)
                        if (shouldScroll && index === 0) {
                            line.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    }
                });

                currentActiveLine = activeLineIds[0];
            } else {
                currentActiveLine = null;
            }
        }

        // ì‹œê°„ í¬ë§·
        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // localStorage
        function loadFromStorage() {
            const savedBookmarks = localStorage.getItem(STORAGE_KEY.bookmarks);
            const savedKnown = localStorage.getItem(STORAGE_KEY.known);
            
            if (savedBookmarks) bookmarkedLines = new Set(JSON.parse(savedBookmarks));
            if (savedKnown) knownWords = new Set(JSON.parse(savedKnown));
        }

        function saveToStorage() {
            localStorage.setItem(STORAGE_KEY.bookmarks, JSON.stringify([...bookmarkedLines]));
            localStorage.setItem(STORAGE_KEY.known, JSON.stringify([...knownWords]));
            localStorage.setItem(STORAGE_KEY.lastStudy, new Date().toISOString().split('T')[0]);
            updateStats();
        }

        // ê°€ì‚¬ ë Œë”ë§
        function renderLyrics() {
            const container = document.getElementById('lyricsContainer');
            container.innerHTML = '';

            songData.lyrics.forEach(line => {
                if (filterKnownWords && knownWords.has(line.id)) return;

                const lineDiv = document.createElement('div');
                lineDiv.className = 'lyric-line';
                lineDiv.dataset.id = line.id;
                
                if (bookmarkedLines.has(line.id)) lineDiv.classList.add('bookmarked');
                if (knownWords.has(line.id)) lineDiv.classList.add('known');

                // ë¡œë§ˆì ë°œìŒ ìƒì„± (ì—†ìœ¼ë©´ ê³µë°±)
                const romanized = line.romanized || generateRomanization(line.jp);

                lineDiv.innerHTML = `
                    <div class="action-buttons">
                        <button class="icon-btn bookmark-btn ${bookmarkedLines.has(line.id) ? 'active' : ''}" 
                                data-id="${line.id}" title="ë¶ë§ˆí¬">
                            ${bookmarkedLines.has(line.id) ? 'â­' : 'â˜†'}
                        </button>
                        <button class="icon-btn known-btn ${knownWords.has(line.id) ? 'active' : ''}" 
                                data-id="${line.id}" title="ì•„ëŠ” ë‹¨ì–´">
                            ${knownWords.has(line.id) ? 'âœ…' : 'â­•'}
                        </button>
                    </div>
                    <div class="jp-text">${line.jp}</div>
                    <div class="reading-text">${line.reading}</div>
                    <div class="romanized-text">${romanized}</div>
                    <div class="kr-text">${line.kr}</div>
                `;

                container.appendChild(lineDiv);
            });

            attachLyricListeners();
        }

        // ë¡œë§ˆì ìƒì„± í•¨ìˆ˜ (ê°„ë‹¨í•œ ë²„ì „)
        function generateRomanization(jp) {
            // ì´ë¯¸ ë¡œë§ˆìê°€ ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©
            // ì—†ìœ¼ë©´ ì¼ë³¸ì–´ í…ìŠ¤íŠ¸ ê·¸ëŒ€ë¡œ í‘œì‹œ (ë‚˜ì¤‘ì— ê°œì„  ê°€ëŠ¥)
            return '';
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        function attachEventListeners() {
            document.getElementById('filterToggle').addEventListener('click', function() {
                filterKnownWords = !filterKnownWords;
                this.classList.toggle('active', filterKnownWords);
                renderLyrics();
                updateStats();
            });
        }

        function attachLyricListeners() {
            // ê°€ì‚¬ í´ë¦­ ì‹œ í•´ë‹¹ ì‹œì ìœ¼ë¡œ ì í”„
            document.querySelectorAll('.lyric-line').forEach(line => {
                line.addEventListener('click', function(e) {
                    // ë²„íŠ¼ í´ë¦­ì€ ì œì™¸
                    if (e.target.closest('.icon-btn')) return;
                    
                    const id = parseInt(this.dataset.id) || parseFloat(this.dataset.id);
                    const lyric = songData.lyrics.find(l => l.id === id);
                    
                    if (lyric && audio.src) {
                        // ê°„ì£¼ì¸ ê²½ìš° (â™ª é–“å¥ â™ª í¬í•¨)
                        if (lyric.jp.includes('é–“å¥') || lyric.jp.includes('â™ª')) {
                            // ê°„ì£¼ëŠ” í´ë¦­í•´ë„ ì•„ë¬´ ì¼ë„ ì¼ì–´ë‚˜ì§€ ì•ŠìŒ
                            return;
                        }
                        
                        // í•´ë‹¹ ê°€ì‚¬ì˜ ì‹œì‘ ì‹œì ìœ¼ë¡œ ì´ë™
                        // (timestampëŠ” ëë‚˜ëŠ” ì‹œì ì´ë¯€ë¡œ ì´ì „ ê°€ì‚¬ì˜ timestamp ì‚¬ìš©)
                        const prevLyric = songData.lyrics.find(l => l.id === id - 1);
                        const seekTime = prevLyric ? prevLyric.timestamp : 0;
                        
                        audio.currentTime = seekTime;
                        
                        // ì¼ì‹œì •ì§€ ìƒíƒœë©´ ìë™ ì¬ìƒ
                        if (audio.paused) {
                            audio.play();
                            playBtn.textContent = 'â¸ï¸';
                        }
                    }
                });
            });

            document.querySelectorAll('.bookmark-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    toggleBookmark(parseInt(this.dataset.id));
                });
            });

            document.querySelectorAll('.known-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    toggleKnown(parseInt(this.dataset.id));
                });
            });
        }

        function toggleBookmark(id) {
            const line = document.querySelector(`.lyric-line[data-id="${id}"]`);
            const btn = line.querySelector('.bookmark-btn');

            if (bookmarkedLines.has(id)) {
                bookmarkedLines.delete(id);
                line.classList.remove('bookmarked');
                btn.classList.remove('active');
                btn.textContent = 'â˜†';
            } else {
                bookmarkedLines.add(id);
                line.classList.add('bookmarked');
                btn.classList.add('active');
                btn.textContent = 'â­';
            }

            saveToStorage();
        }

        function toggleKnown(id) {
            const line = document.querySelector(`.lyric-line[data-id="${id}"]`);
            const btn = line.querySelector('.known-btn');

            if (knownWords.has(id)) {
                knownWords.delete(id);
                line.classList.remove('known');
                btn.classList.remove('active');
                btn.textContent = 'â­•';
            } else {
                knownWords.add(id);
                line.classList.add('known');
                btn.classList.add('active');
                btn.textContent = 'âœ…';
            }

            saveToStorage();
        }

        function updateStats() {
            const total = songData.lyrics.length;
            const expanded = Array.from(expandedLines).filter(id => Number.isInteger(id)).length;
            const progress = Math.round((expanded / total) * 100);
            
            const lastStudy = localStorage.getItem(STORAGE_KEY.lastStudy);
            const lastStudyDisplay = lastStudy ? 
                (lastStudy === new Date().toISOString().split('T')[0] ? 'ì˜¤ëŠ˜' : lastStudy) : '-';

            document.getElementById('statBookmarks').textContent = bookmarkedLines.size;
            document.getElementById('statProgress').textContent = progress + '%';
            document.getElementById('statKnown').textContent = knownWords.size;
            document.getElementById('statLastStudy').textContent = lastStudyDisplay;
        }

        init();
    </script>
</body>
</html>